<!DOCTYPE html>
<html lang="de">
<head>

    
    <!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">  -->
    <!-- /*Zoom*/-->
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=3.0, user-scalable=yes">


    <meta charset="UTF-8" />
    <title>Aktionspotenzial – offline</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 40px;
            background-color: #F6F8E2;
            color: #1d1d1f;
        }

        h2 {
            text-align: center;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }

        .control {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label {
            font-weight: 500;
        }

        input, select, button {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        button {
            background-color: #007aff;
            color: white;
            cursor: pointer;
            border: none;
            margin-right: 10px;
            justify-content: center;
        }

            button:hover {
                background-color: #005bb5;
                box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            }

        .button2 {
            display: flex;
            justify-content: center;
            margin-right: 100px;
        }

        canvas {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            display: block;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .info-box {
            max-width: 1000px;
            margin: 30px auto;
            background-color: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            font-size: 16px;
            line-height: 1.6;
        }

            .info-box h3 {
                font-size: 20px;
                font-weight: 600;
                margin-bottom: 12px;
                color: #1d1d1f;
            }

            .info-box p {
                margin: 6px 0;
                color: #3a3a3c;
            }
    </style>
</head>
<body>
    <h2>Ruhe- und Aktionspotenzial von Motoneuron und Herzmuskelzelle (+Ionenströme)</h2>
    <div class="button2">
        <button id="btnUpdate">Aktualisieren</button>
        <button id="btnReset">Seite neu laden</button>
        <button onclick="openQRCode()">QR-Code anzeigen</button>
    </div>

    <div class="controls">
        <div class="control">
            <label>Na⁺ außen (mmol)</label>
            <input id="naOut" type="number" value="140" min="0" max="1000">
        </div>
        <div class="control">
            <label>Na⁺ innen (mmol)</label>
            <input id="naIn" type="number" value="15" min="0" max="1000">
        </div>
        <div class="control">
            <label>K⁺ außen (mmol)</label>
            <input id="kOut" type="number" value="4" min="0" max="1000">
        </div>
        <div class="control">
            <label>K⁺ innen (mmol)</label>
            <input id="kIn" type="number" value="140" min="0" max="1000">
        </div>
        <div class="control">
            <label>Zelltyp</label>
            <select id="cellType">
                <option value="neuron">Motoneuron</option>
                <option value="heart">Herzmuskelzelle</option>
            </select>
        </div>
    </div>

    <canvas id="apChart" width="1000" height="400"></canvas>

    <div class="info-box">
        <h3>Biologische Erklärung:</h3>
        <p>Standardwerte: Reizschwelle −55 mV, Amplitude +30 mV, Ruhepotenzial ≈ −70 mV.</p>
        <p>Dauer AP-Motoneuron ≈ 8 ms, Herzmuskelzelle ≈ 200 ms.</p>
        <p>Cl⁻-Ströme stark vereinfacht dargestellt.</p>
    </div>

   

    <script src="libs/chart.umd.min.js"></script>
    <script>
        function initApp() {
            const R = 8.314, T = 310, F = 96485;

            function nernst(out, inside, charge = 1) {
                if (out <= 0 || inside <= 0) return 0;
                return (R * T) / (charge * F) * Math.log(out / inside) * 1000;
            }

            const ctx = document.getElementById('apChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    stacked: false,
                    scales: {
                        x: { title: { display: true, text: 'Zeit (ms)' } },
                        y: { type: 'linear', position: 'left', title: { display: true, text: 'Membranpotenzial (mV)' }, min: -120, max: 60 },
                        y1: { type: 'linear', position: 'right', title: { display: true, text: 'Ionenströme (rel. Einheit)' }, grid: { drawOnChartArea: false } }
                    },
                    elements: { point: { radius: 0 } }
                }
            });

            function generateData() {
                const naOut = +document.getElementById("naOut").value;
                const naIn = +document.getElementById("naIn").value;
                const kOut = +document.getElementById("kOut").value;
                const kIn = +document.getElementById("kIn").value;
                const clOut = 110, clIn = 0.0001;
                const cellType = document.getElementById("cellType").value;

                const eNa = nernst(naOut, naIn);
                const eK = nernst(kOut, kIn);
                const eCl = nernst(clIn, clOut, -1);
                const Vrest = 1.35 * eK + 0.3 * eNa + 0.1 * eCl;
                const threshold = -55, peak = eNa - 10;
                const plateau = cellType === 'heart' ? 10 : peak;
                const duration = 40;

                const time = [], voltage = [], naCurrent = [], kCurrent = [], clCurrent = [], thresholdLine = [];
                for (let t = 0; t <= duration; t += 0.5) {
                    let v;
                    if (t < 2) v = Vrest;
                    else if (t < 4) v = Vrest + (t - 2) * (peak - Vrest) / 2;
                    else if (cellType === 'heart' && t < 15) v = plateau;
                    else if (t < 20) v = peak - (t - 4) * (peak - Vrest) / 16;
                    else if (t < 30) v = Vrest - 10 + (t - 20);
                    else v = Vrest;

                    time.push(Math.round(t * 10) / 10);
                    voltage.push(Math.round(v * 10) / 10);
                    naCurrent.push(eNa - v);
                    kCurrent.push(v - eK);
                    clCurrent.push(eCl - v);
                    thresholdLine.push(threshold);
                }
                return { time, voltage, naCurrent, kCurrent, clCurrent, thresholdLine };
            }

            function updateGraph() {
                const data = generateData();
                chart.data.labels = data.time;
                chart.data.datasets = [
                    { label: 'Aktionspotenzial', data: data.voltage, yAxisID: 'y', borderColor: '#007aff', borderWidth: 2, tension: 0.3 },
                    { label: 'Reizschwelle', data: data.thresholdLine, yAxisID: 'y', borderColor: 'gray', borderDash: [5, 5], borderWidth: 1 },
                    { label: 'Na⁺-Strom', data: data.naCurrent, yAxisID: 'y1', borderColor: 'red', borderWidth: 1, tension: 0.3 },
                    { label: 'K⁺-Strom', data: data.kCurrent, yAxisID: 'y1', borderColor: 'green', borderWidth: 1, tension: 0.3 },
                    { label: 'Cl⁻-Strom', data: data.clCurrent, yAxisID: 'y1', borderColor: 'orange', borderWidth: 1, tension: 0.3 }
                ];
                chart.update();
            }

            function resetPage() {
                document.getElementById('naOut').value = 140;
                document.getElementById('naIn').value = 15;
                document.getElementById('kOut').value = 4;
                document.getElementById('kIn').value = 140;
                document.getElementById('cellType').value = 'neuron';
                updateGraph();
            }

            document.getElementById('btnUpdate').onclick = updateGraph;
            document.getElementById('btnReset').onclick = resetPage;
            document.getElementById('cellType').addEventListener('change', updateGraph);

            updateGraph();
            document.getElementById('apChart').style.opacity = 1;
        }

        // Initialisierung für Safari + iOS sicher
        window.addEventListener('load', () => {
            setTimeout(() => requestAnimationFrame(initApp), 150);
        });
        window.addEventListener('pageshow', e => {
            if (e.persisted) setTimeout(() => requestAnimationFrame(initApp), 150);
        });
    </script>




    <script>
        function openQRCode() {
            const currentUrl = window.location.href;
            const qrWin = window.open("", "_blank", "width=520,height=600,resizable=yes,scrollbars=no");

            qrWin.document.write(`
               <html lang="de">
               <head>
                 <meta charset="UTF-8">
                 <title>QR-Code</title>
                 <style>
                   body {
                     font-family: Arial, sans-serif;
                     text-align: center;
                     background: #fff;
                     padding: 30px;
                   }
                   #qrcode { margin-top: 40px; }
                   button {
                     margin-top: 40px;
                     background: #0071e3;
                     color: #fff;
                     border: none;
                     border-radius: 10px;
                     font-size: 16px;
                     padding: 10px 20px;
                     cursor: pointer;
                   }
                   button:hover { background: #005bb5; }
                 </style>
               </head>
               <body>
                 <h2>QR-Code zu dieser Seite</h2>
                 <div id="qrcode"></div>
                 <button onclick="window.close()">Fenster schließen</button>
                 <script src="libs/qrcode.min.js"><\/script>
                 <script>
                   window.addEventListener('load', function() {
                     new QRCode(document.getElementById("qrcode"), {
                       text: "${currentUrl}",
                       width: 220,
                       height: 220,
                       correctLevel: QRCode.CorrectLevel.H
                     });
                   });
                 <\/script>
               </body>
               </html>
             `);

            qrWin.document.close();
        }
    </script>


</body>
</html>
