<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Nahrungsnetz – Touch & Maus Drag & Drop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
            background-color: #F6F8E2;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h3 {
            color: #1d1d1f;
            margin-bottom: 10px;
            text-align: center;
        }

        #board {
            position: relative;
            width: 90vw;
            max-width: 1250px;
            height: 80vh;
            max-height: 900px;
            background-image: url("./Pics/Nahrungsnetz22.jpg");
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            touch-action: none; /* wichtig für iPad */
        }

        .draggable {
            width: 80px;
            height: 80px;
            position: absolute;
            cursor: grab;
            border-radius: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            background-color: white;
            user-select: none;
            touch-action: none;
            transition: transform 0.1s ease-out;
        }

        #controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

            #controls button {
                background: #007aff;
                color: white;
                border: none;
                border-radius: 12px;
                padding: 10px 20px;
                font-size: 14px;
                cursor: pointer;
                transition: background 0.3s;
            }

                #controls button:hover {
                    background: #005bb5;
                }

        #message {
            margin-top: 15px;
            font-weight: bold;
        }

        #explanation {
            width: 90%;
            max-width: 700px;
            padding: 10px;
            border-radius: 12px;
            border: 1px solid #ccc;
            margin: 15px 0;
            resize: none;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h3>Nahrungsnetze: Ziehe die Organismen auf die richtige Position</h3>

    <div id="board"></div>

    <div id="controls">
        <button onclick="location.reload()">Seite neu laden</button>
        <button onclick="checkPositions()">Überprüfen</button>
    </div>

    <div id="message"></div>

    <textarea id="explanation" rows="6" placeholder="Hier deine Erklärung eingeben...">
Motto der Nahrungsnetze: Wer wird von wem gefressen.
1. Beschreibe die Folgen:
   a) wenn Stieleiche und Fichte gefällt werden
   b) wenn die Kohlmeise ausgerottet wird
   c) wenn alle Füchse und Sperber verschwinden
  </textarea>

    <script>
        const board = document.getElementById('board');
        const message = document.getElementById('message');
        const images = [];

        // Zielkoordinaten (angepasst an Original)
        const targets = [
            { x: 870, y: 300 }, { x: 1105, y: 300 }, { x: 850, y: 500 },
            { x: 130, y: 660 }, { x: 270, y: 80 }, { x: 645, y: 80 },
            { x: 755, y: 660 }, { x: 1050, y: 660 }, { x: 380, y: 300 },
            { x: 430, y: 660 }, { x: 650, y: 380 }, { x: 90, y: 300 },
            { x: 930, y: 80 }
        ];

        // Bilder erzeugen
        for (let i = 1; i <= 13; i++) {
            const img = document.createElement('img');
            img.src = `images/Bild${i}.png`;
            img.className = 'draggable';
            img.style.left = `${30 + (i - 1) * 85}px`;
            img.style.top = `${board.clientHeight - 90}px`;
            img.dataset.index = i - 1;
            board.appendChild(img);
            images.push(img);
            makeDraggable(img);
        }

        function makeDraggable(el) {
            let offsetX = 0, offsetY = 0, dragging = false;

            // Für Maus
            el.addEventListener('mousedown', startDrag);
            // Für Touch
            el.addEventListener('touchstart', startDrag, { passive: false });

            function startDrag(e) {
                e.preventDefault();
                dragging = true;
                el.style.cursor = 'grabbing';

                const rect = el.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                offsetX = clientX - rect.left;
                offsetY = clientY - rect.top;

                // Maus bewegt
                document.addEventListener('mousemove', moveDrag);
                document.addEventListener('mouseup', stopDrag);

                // Touch bewegt
                document.addEventListener('touchmove', moveDrag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            }

            function moveDrag(e) {
                if (!dragging) return;
                e.preventDefault();

                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const boardRect = board.getBoundingClientRect();

                let newX = clientX - boardRect.left - offsetX;
                let newY = clientY - boardRect.top - offsetY;

                // Begrenzung innerhalb des Boards
                newX = Math.max(0, Math.min(board.clientWidth - el.offsetWidth, newX));
                newY = Math.max(0, Math.min(board.clientHeight - el.offsetHeight, newY));

                el.style.left = newX + 'px';
                el.style.top = newY + 'px';
            }

            function stopDrag() {
                dragging = false;
                el.style.cursor = 'grab';
                document.removeEventListener('mousemove', moveDrag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', moveDrag);
                document.removeEventListener('touchend', stopDrag);
            }
        }

        function checkPositions() {
            let errors = 0;
            images.forEach((img, i) => {
                const rect = img.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                const x = rect.left - boardRect.left;
                const y = rect.top - boardRect.top;

                const target = targets[i];
                const dist = Math.hypot(x - target.x, y - target.y);
                if (dist > 60) errors++;
            });

            if (errors === 0) {
                message.style.color = '#34c759';
                message.textContent = 'Alle Glieder im Nahrungsnetz korrekt platziert! ✅';
            } else {
                message.style.color = '#ff3b30';
                message.textContent = `${errors} Glieder falsch platziert.`;
            }
        }
    </script>
</body>
</html>
